'use client';

import React, { useState, useEffect } from 'react';
import { Card, Button, Input, message, Form, Space, Divider, Table, Modal, Row, Col, Radio, Tabs } from 'antd';
import { SaveOutlined, EyeOutlined, ReloadOutlined, QuestionCircleOutlined, PlusOutlined, EditOutlined, DeleteOutlined } from '@ant-design/icons';
import { useAdminAuth } from '../../../../contexts/admin-auth-context';
import { apiFetch } from '../../../../lib/api';

const { TextArea } = Input;

interface FAQ {
  _id: string;
  question: {
    ar: string;
    en: string;
  };
  answer: {
    ar: string;
    en: string;
  };
  category: string;
  status: 'active' | 'inactive';
  order: number;
  createdAt: string;
  updatedAt: string;
}

interface FAQPageSettings {
  pageTitle: string;
  pageDescription: string;
  introText: string;
  contactText: string;
  seoTitle: string;
  seoDescription: string;
  seoKeywords: string;
  ogImage: string;
  canonicalUrl: string;
}

export default function FAQManagementPage() {
  const { admin, token } = useAdminAuth();
  const [settingsForm] = Form.useForm();
  const [faqForm] = Form.useForm();
  
  const [loading, setLoading] = useState(false);
  const [saving, setSaving] = useState(false);
  const [faqs, setFaqs] = useState<FAQ[]>([]);
  const [isModalVisible, setIsModalVisible] = useState(false);
  const [editingFaq, setEditingFaq] = useState<FAQ | null>(null);
  const [activeTab, setActiveTab] = useState('settings');
  const [isMobile, setIsMobile] = useState(false);

  // Check if mobile screen
  useEffect(() => {
    const checkMobile = () => {
      setIsMobile(window.innerWidth < 768);
    };
    
    checkMobile();
    window.addEventListener('resize', checkMobile);
    return () => window.removeEventListener('resize', checkMobile);
  }, []);

  const [pageSettings, setPageSettings] = useState<FAQPageSettings>({
    pageTitle: 'ÿßŸÑÿ£ÿ≥ÿ¶ŸÑÿ© ÿßŸÑÿ¥ÿßÿ¶ÿπÿ©',
    pageDescription: 'ÿ•ÿ¨ÿßÿ®ÿßÿ™ ÿ¥ÿßŸÖŸÑÿ© ÿπŸÑŸâ ÿ£ŸÉÿ´ÿ± ÿßŸÑÿ£ÿ≥ÿ¶ŸÑÿ© ÿßŸÑÿ™Ÿä Ÿäÿ∑ÿ±ÿ≠Ÿáÿß ÿπŸÖŸÑÿßÿ§ŸÜÿß',
    introText: 'ŸÜÿ¨ŸÖÿπ ŸáŸÜÿß ÿ£ŸÉÿ´ÿ± ÿßŸÑÿ£ÿ≥ÿ¶ŸÑÿ© ÿ¥ŸäŸàÿπÿßŸã ŸÖŸÜ ÿπŸÖŸÑÿßÿ¶ŸÜÿß ŸÖÿπ ÿ•ÿ¨ÿßÿ®ÿßÿ™ ŸÖŸÅÿµŸÑÿ© ŸÑŸÖÿ≥ÿßÿπÿØÿ™ŸÉ',
    contactText: 'ŸÑŸÖ ÿ™ÿ¨ÿØ ÿ•ÿ¨ÿßÿ®ÿ©ÿü ÿ™ŸàÿßÿµŸÑ ŸÖÿπŸÜÿß ŸÖÿ®ÿßÿ¥ÿ±ÿ© Ÿàÿ≥ŸÜÿ¨Ÿäÿ® ÿπŸÑŸâ ÿßÿ≥ÿ™ŸÅÿ≥ÿßÿ±ŸÉ',
    seoTitle: 'ÿßŸÑÿ£ÿ≥ÿ¶ŸÑÿ© ÿßŸÑÿ¥ÿßÿ¶ÿπÿ© | ÿ®ÿµŸÖÿ© ÿ™ÿµŸÖŸäŸÖ - ÿ•ÿ¨ÿßÿ®ÿßÿ™ ÿ¥ÿßŸÖŸÑÿ© ÿ≠ŸàŸÑ ÿÆÿØŸÖÿßÿ™ ÿßŸÑÿ™ÿµŸÖŸäŸÖ',
    seoDescription: 'ÿ•ÿ¨ÿßÿ®ÿßÿ™ ÿ¥ÿßŸÖŸÑÿ© ÿπŸÑŸâ ÿ£ŸÉÿ´ÿ± ÿßŸÑÿ£ÿ≥ÿ¶ŸÑÿ© ÿ¥ŸäŸàÿπÿßŸã ÿ≠ŸàŸÑ ÿÆÿØŸÖÿßÿ™ŸÜÿß ŸÅŸä ÿßŸÑÿ™ÿµŸÖŸäŸÖ ŸàÿßŸÑŸÖÿ≠ÿ™ŸàŸâ ÿßŸÑÿ±ŸÇŸÖŸä. ÿßÿ≥ÿ™ŸÅÿ≥ÿßÿ±ÿßÿ™ ÿßŸÑÿπŸÖŸÑÿßÿ° ŸàÿßŸÑÿ≠ŸÑŸàŸÑ ÿßŸÑÿ≥ÿ±Ÿäÿπÿ©.',
    seoKeywords: 'ÿ£ÿ≥ÿ¶ŸÑÿ© ÿ¥ÿßÿ¶ÿπÿ©ÿå ÿßÿ≥ÿ™ŸÅÿ≥ÿßÿ±ÿßÿ™ÿå ÿÆÿØŸÖÿßÿ™ ÿßŸÑÿ™ÿµŸÖŸäŸÖÿå ÿØÿπŸÖ ÿßŸÑÿπŸÖŸÑÿßÿ°ÿå ÿ®ÿµŸÖÿ© ÿ™ÿµŸÖŸäŸÖÿå ÿ•ÿ¨ÿßÿ®ÿßÿ™ ÿ≥ÿ±Ÿäÿπÿ©',
    ogImage: '/faq-og-image.jpg',
    canonicalUrl: 'https://basmatdesign.com/faq'
  });

  const categories = [
    { value: 'general', label: 'ÿ£ÿ≥ÿ¶ŸÑÿ© ÿπÿßŸÖÿ©' },
    { value: 'pricing', label: 'ÿßŸÑÿ£ÿ≥ÿπÿßÿ± ŸàÿßŸÑÿØŸÅÿπ' },
    { value: 'design', label: 'ÿßŸÑÿ™ÿµŸÖŸäŸÖ ŸàÿßŸÑÿ¨ŸàÿØÿ©' },
    { value: 'delivery', label: 'ÿßŸÑÿ™ÿ≥ŸÑŸäŸÖ ŸàÿßŸÑÿ™ÿπÿØŸäŸÑÿßÿ™' },
    { value: 'files', label: 'ÿßŸÑŸÖŸÑŸÅÿßÿ™ ŸàÿßŸÑÿµŸäÿ∫' }
  ];

  useEffect(() => {
    if (admin && token) {
      loadData();
    }
  }, [admin, token]);

  const loadData = async () => {
    setLoading(true);
    try {
      await Promise.all([
        loadPageSettings(),
        loadFAQs()
      ]);
    } catch (error) {
    } finally {
      setLoading(false);
    }
  };

  const loadPageSettings = async () => {
    try {
      const response = await apiFetch('/settings?category=faq', {
        auth: true
      }) as any;
      
      // Handle different response structures
      let settingsArray = [];
      if (response?.success && response?.data) {
        settingsArray = response.data;
      } else if (Array.isArray(response)) {
        settingsArray = response;
      } else if (response?.data && Array.isArray(response.data)) {
        settingsArray = response.data;
      }
      
      if (settingsArray && Array.isArray(settingsArray)) {
        const settings: Record<string, any> = {};
        settingsArray.forEach((item: any) => {
          settings[item.key] = item.value;
        });
        
        setPageSettings(prev => ({ ...prev, ...settings }));
        settingsForm.setFieldsValue(settings);
      }
    } catch (error) {
    }
  };

  const loadFAQs = async () => {
    try {
      const response = await apiFetch('/admin/faqs', {
        headers: { 'Authorization': `Bearer ${token}` }
      }) as any;
      
      if (response?.success && response?.data?.faqs) {
        setFaqs(response.data.faqs);
      }
    } catch (error) {
    }
  };

  const savePageSettings = async () => {
    setSaving(true);
    try {
      const formData = settingsForm.getFieldsValue();
      
      const response = await apiFetch('/admin/settings/faq', {
        method: 'PUT',
        auth: true,
        body: JSON.stringify(formData)
      }) as any;

      if (response?.success) {
        message.success('ÿ™ŸÖ ÿ≠ŸÅÿ∏ ÿ•ÿπÿØÿßÿØÿßÿ™ ÿßŸÑÿµŸÅÿ≠ÿ© ÿ®ŸÜÿ¨ÿßÿ≠');
        setPageSettings(prev => ({ ...prev, ...formData }));
        // ÿ•ÿπÿßÿØÿ© ÿ™ÿ≠ŸÖŸäŸÑ ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™ ŸÑŸÑÿ™ÿ£ŸÉÿØ ŸÖŸÜ ÿßŸÑÿ≠ŸÅÿ∏
        await loadPageSettings();
      } else {
        message.error('ŸÅÿ¥ŸÑ ŸÅŸä ÿ≠ŸÅÿ∏ ÿ•ÿπÿØÿßÿØÿßÿ™ ÿßŸÑÿµŸÅÿ≠ÿ©');
      }
    } catch (error) {
      message.error('ŸÅÿ¥ŸÑ ŸÅŸä ÿ≠ŸÅÿ∏ ÿ•ÿπÿØÿßÿØÿßÿ™ ÿßŸÑÿµŸÅÿ≠ÿ©');
    } finally {
      setSaving(false);
    }
  };

  const saveFAQ = async () => {
    try {
      const values = await faqForm.validateFields();
      // Normalize multilingual structure so backend doesn't 500 when EN fields are hidden
      const normalized = { ...values } as any;
      // Question
      if (typeof normalized.question === 'string') {
        normalized.question = { ar: normalized.question, en: normalized.question };
      } else if (normalized.question && typeof normalized.question === 'object') {
        const ar = normalized.question.ar || '';
        const en = normalized.question.en || ar;
        normalized.question = { ar, en };
      }
      // Answer
      if (typeof normalized.answer === 'string') {
        normalized.answer = { ar: normalized.answer, en: normalized.answer };
      } else if (normalized.answer && typeof normalized.answer === 'object') {
        const ar = normalized.answer.ar || '';
        const en = normalized.answer.en || ar;
        normalized.answer = { ar, en };
      }
      const method = editingFaq ? 'PUT' : 'POST';
      const endpoint = editingFaq ? `/admin/faqs/${editingFaq._id}` : '/admin/faqs';

      const response = await apiFetch(endpoint, {
        method,
        headers: {
          'Authorization': `Bearer ${token}`,
          'Content-Type': 'application/json'
        },
        body: JSON.stringify(normalized)
      }) as any;

      if (response.success) {
        message.success(editingFaq ? 'ÿ™ŸÖ ÿ™ÿ≠ÿØŸäÿ´ ÿßŸÑÿ≥ÿ§ÿßŸÑ ÿ®ŸÜÿ¨ÿßÿ≠' : 'ÿ™ŸÖ ÿ•ÿ∂ÿßŸÅÿ© ÿßŸÑÿ≥ÿ§ÿßŸÑ ÿ®ŸÜÿ¨ÿßÿ≠');
        setIsModalVisible(false);
        setEditingFaq(null);
        faqForm.resetFields();
        await loadFAQs();
      } else {
        message.error('ŸÅÿ¥ŸÑ ŸÅŸä ÿ≠ŸÅÿ∏ ÿßŸÑÿ≥ÿ§ÿßŸÑ');
      }
    } catch (error) {
      message.error('ŸÅÿ¥ŸÑ ŸÅŸä ÿ≠ŸÅÿ∏ ÿßŸÑÿ≥ÿ§ÿßŸÑ');
    }
  };

  const deleteFAQ = async (id: string) => {
    try {
      const response = await apiFetch(`/admin/faqs/${id}`, {
        method: 'DELETE',
        headers: { 'Authorization': `Bearer ${token}` }
      }) as any;

      if (response.success) {
        message.success('ÿ™ŸÖ ÿ≠ÿ∞ŸÅ ÿßŸÑÿ≥ÿ§ÿßŸÑ ÿ®ŸÜÿ¨ÿßÿ≠');
        await loadFAQs();
      } else {
        message.error('ŸÅÿ¥ŸÑ ŸÅŸä ÿ≠ÿ∞ŸÅ ÿßŸÑÿ≥ÿ§ÿßŸÑ');
      }
    } catch (error) {
      message.error('ŸÅÿ¥ŸÑ ŸÅŸä ÿ≠ÿ∞ŸÅ ÿßŸÑÿ≥ÿ§ÿßŸÑ');
    }
  };

  const openEditModal = (faq?: FAQ) => {
    setEditingFaq(faq || null);
    if (faq) {
      faqForm.setFieldsValue(faq);
    } else {
      faqForm.resetFields();
      faqForm.setFieldsValue({
        order: faqs.length + 1,
        status: 'active'
      });
    }
    setIsModalVisible(true);
  };

  const openAddModal = () => {
    openEditModal();
  };

  const columns = [
    {
      title: (
        <div className="flex items-center gap-2 font-semibold text-gray-700">
          <span className="text-blue-500">‚ùì</span>
          ÿßŸÑÿ≥ÿ§ÿßŸÑ
        </div>
      ),
      dataIndex: ['question', 'ar'],
      key: 'question',
      ellipsis: true,
      render: (text: string) => (
        <div className="flex items-start gap-3">
          <div className="w-8 h-8 bg-gradient-to-r from-blue-500 to-purple-600 rounded-lg flex items-center justify-center flex-shrink-0">
            <span className="text-white text-xs font-bold">Q</span>
          </div>
          <div className="font-medium text-gray-800 line-clamp-2 leading-relaxed">
            {text}
          </div>
        </div>
      ),
    },
    {
      title: (
        <div className="flex items-center gap-2 font-semibold text-gray-700">
          <span className="text-green-500">üè∑Ô∏è</span>
          ÿßŸÑÿ™ÿµŸÜŸäŸÅ
        </div>
      ),
      dataIndex: 'category',
      key: 'category',
      width: 180,
      render: (category: string) => {
        const cat = categories.find(c => c.value === category);
        const colors = {
          'general': 'bg-blue-100 text-blue-800 border-blue-200',
          'pricing': 'bg-green-100 text-green-800 border-green-200',
          'design': 'bg-purple-100 text-purple-800 border-purple-200',
          'delivery': 'bg-orange-100 text-orange-800 border-orange-200',
          'files': 'bg-pink-100 text-pink-800 border-pink-200'
        };
        const colorClass = colors[category as keyof typeof colors] || 'bg-gray-100 text-gray-800 border-gray-200';
        
        return (
          <div className={`inline-flex items-center gap-2 px-3 py-1.5 rounded-full text-sm font-medium border ${colorClass}`}>
            <span className="w-2 h-2 rounded-full bg-current opacity-60"></span>
            {cat ? cat.label : category}
          </div>
        );
      },
    },
    {
      title: (
        <div className="flex items-center gap-2 font-semibold text-gray-700">
          <span className="text-amber-500">üìä</span>
          ÿßŸÑÿ™ÿ±ÿ™Ÿäÿ®
        </div>
      ),
      dataIndex: 'order',
      key: 'order',
      width: 100,
      align: 'center' as const,
      render: (order: number) => (
        <div className="flex items-center justify-center">
          <div className="w-8 h-8 bg-gradient-to-r from-amber-400 to-orange-500 rounded-full flex items-center justify-center">
            <span className="text-white text-sm font-bold">{order}</span>
          </div>
        </div>
      ),
    },
    {
      title: (
        <div className="flex items-center gap-2 font-semibold text-gray-700">
          <span className="text-red-500">‚öôÔ∏è</span>
          ÿßŸÑÿ•ÿ¨ÿ±ÿßÿ°ÿßÿ™
        </div>
      ),
      key: 'actions',
      width: 180,
      align: 'center' as const,
      render: (_: any, record: FAQ) => (
        <div className="flex items-center justify-center gap-2">
          <Button
            type="primary"
            icon={<EditOutlined />}
            size="small"
            className="bg-gradient-to-r from-blue-500 to-blue-600 border-0 hover:from-blue-600 hover:to-blue-700 shadow-md"
            onClick={() => openEditModal(record)}
          >
            ÿ™ÿπÿØŸäŸÑ
          </Button>
          <Button
            danger
            icon={<DeleteOutlined />}
            size="small"
            className="bg-gradient-to-r from-red-500 to-red-600 border-0 hover:from-red-600 hover:to-red-700 shadow-md"
            onClick={() => {
              Modal.confirm({
                title: 'ÿ≠ÿ∞ŸÅ ÿßŸÑÿ≥ÿ§ÿßŸÑ',
                content: 'ŸáŸÑ ÿ£ŸÜÿ™ ŸÖÿ™ÿ£ŸÉÿØ ŸÖŸÜ ÿ≠ÿ∞ŸÅ Ÿáÿ∞ÿß ÿßŸÑÿ≥ÿ§ÿßŸÑÿü',
                onOk: () => deleteFAQ(record._id),
              });
            }}
          >
            ÿ≠ÿ∞ŸÅ
          </Button>
        </div>
      ),
    },
  ];

  if (!admin) {
    if (typeof window !== 'undefined') {
      window.location.href = '/admin/login?message=redirect';
    }
    return null;
  }

  return (
    <div className={isMobile ? "p-4" : "p-6"}>
      <div className="mb-6">
        <h1 className={`font-bold text-gray-900 mb-2 flex items-center gap-2 ${
          isMobile ? 'text-xl' : 'text-2xl'
        }`}>
          <QuestionCircleOutlined />
          ÿ•ÿØÿßÿ±ÿ© ÿßŸÑÿ£ÿ≥ÿ¶ŸÑÿ© ÿßŸÑÿ¥ÿßÿ¶ÿπÿ©
        </h1>
        <p className={`text-gray-600 ${isMobile ? 'text-sm' : ''}`}>
          ÿ™ÿ≠ŸÉŸÖ ŸÅŸä ÿ•ÿπÿØÿßÿØÿßÿ™ ÿµŸÅÿ≠ÿ© ÿßŸÑÿ£ÿ≥ÿ¶ŸÑÿ© ÿßŸÑÿ¥ÿßÿ¶ÿπÿ© Ÿàÿ•ÿØÿßÿ±ÿ© ÿßŸÑÿ£ÿ≥ÿ¶ŸÑÿ© ŸàÿßŸÑÿ•ÿ¨ÿßÿ®ÿßÿ™
        </p>
      </div>

      {isMobile ? (
        // Mobile Layout with Tabs
        <Tabs
          activeKey={activeTab}
          onChange={setActiveTab}
          items={[
            {
              key: 'settings',
              label: 'ÿ•ÿπÿØÿßÿØÿßÿ™ ÿßŸÑÿµŸÅÿ≠ÿ©',
              children: (
                <Card className="bg-blue-50">
                  <Form form={settingsForm} layout="vertical" initialValues={pageSettings} key={JSON.stringify(pageSettings)}>
                    <Form.Item name="pageTitle" label="ÿπŸÜŸàÿßŸÜ ÿßŸÑÿµŸÅÿ≠ÿ©">
                      <Input placeholder="ÿßŸÑÿ£ÿ≥ÿ¶ŸÑÿ© ÿßŸÑÿ¥ÿßÿ¶ÿπÿ©" />
                    </Form.Item>
                    <Form.Item name="pageDescription" label="ŸàÿµŸÅ ÿßŸÑÿµŸÅÿ≠ÿ©">
                      <Input placeholder="ÿ•ÿ¨ÿßÿ®ÿßÿ™ ÿ¥ÿßŸÖŸÑÿ© ÿπŸÑŸâ ÿ£ŸÉÿ´ÿ± ÿßŸÑÿ£ÿ≥ÿ¶ŸÑÿ©..." />
                    </Form.Item>
                    <Form.Item name="introText" label="ÿßŸÑŸÜÿµ ÿßŸÑÿ™ŸÖŸáŸäÿØŸä">
                      <TextArea rows={3} placeholder="ŸÜÿ¨ŸÖÿπ ŸáŸÜÿß ÿ£ŸÉÿ´ÿ± ÿßŸÑÿ£ÿ≥ÿ¶ŸÑÿ© ÿ¥ŸäŸàÿπÿßŸã..." />
                    </Form.Item>
                    <Form.Item name="contactText" label="ŸÜÿµ ÿßŸÑÿ™ŸàÿßÿµŸÑ">
                      <TextArea rows={2} placeholder="ŸÑŸÖ ÿ™ÿ¨ÿØ ÿ•ÿ¨ÿßÿ®ÿ©ÿü ÿ™ŸàÿßÿµŸÑ ŸÖÿπŸÜÿß..." />
                    </Form.Item>
                    <Form.Item name="seoTitle" label="ÿπŸÜŸàÿßŸÜ SEO">
                      <Input placeholder="ÿßŸÑÿ£ÿ≥ÿ¶ŸÑÿ© ÿßŸÑÿ¥ÿßÿ¶ÿπÿ© | ÿ®ÿµŸÖÿ© ÿ™ÿµŸÖŸäŸÖ..." />
                    </Form.Item>
                    <Form.Item name="seoDescription" label="ŸàÿµŸÅ SEO">
                      <TextArea rows={2} placeholder="ÿ•ÿ¨ÿßÿ®ÿßÿ™ ÿ¥ÿßŸÖŸÑÿ© ÿπŸÑŸâ ÿ£ŸÉÿ´ÿ± ÿßŸÑÿ£ÿ≥ÿ¶ŸÑÿ©..." />
                    </Form.Item>
                    <Form.Item name="seoKeywords" label="ŸÉŸÑŸÖÿßÿ™ ŸÖŸÅÿ™ÿßÿ≠Ÿäÿ©">
                      <Input placeholder="ÿ£ÿ≥ÿ¶ŸÑÿ© ÿ¥ÿßÿ¶ÿπÿ©ÿå ÿßÿ≥ÿ™ŸÅÿ≥ÿßÿ±ÿßÿ™..." />
                    </Form.Item>
                    
                    <div className="flex gap-2 mt-4">
                      <Button
                        type="primary"
                        icon={<SaveOutlined />}
                        loading={saving}
                        onClick={savePageSettings}
                        className="flex-1"
                      >
                        ÿ≠ŸÅÿ∏ ÿßŸÑÿ•ÿπÿØÿßÿØÿßÿ™
                      </Button>
                      <Button
                        icon={<ReloadOutlined />}
                        onClick={loadData}
                        loading={loading}
                      >
                        ÿ™ÿ≠ÿØŸäÿ´
                      </Button>
                    </div>
                  </Form>
                </Card>
              )
            },
            {
              key: 'faqs',
              label: 'ÿßŸÑÿ£ÿ≥ÿ¶ŸÑÿ© ŸàÿßŸÑÿ•ÿ¨ÿßÿ®ÿßÿ™',
              children: (
                <div className="space-y-4">
                  <div className="flex justify-between items-center">
                    <h3 className="text-lg font-semibold">ŸÇÿßÿ¶ŸÖÿ© ÿßŸÑÿ£ÿ≥ÿ¶ŸÑÿ©</h3>
                    <Button
                      type="primary"
                      icon={<PlusOutlined />}
                      onClick={() => openAddModal()}
                      size="small"
                    >
                      ÿ•ÿ∂ÿßŸÅÿ© ÿ≥ÿ§ÿßŸÑ
                    </Button>
                  </div>
                  
                  {/* Mobile FAQ Cards */}
                  <div className="space-y-3">
                    {faqs.map((faq) => (
                      <Card key={faq._id} size="small" className="border-l-4 border-l-purple-500">
                        <div className="space-y-2">
                          <div className="flex justify-between items-start">
                            <h4 className="font-medium text-gray-900 text-sm leading-tight">
                              {faq.question.ar}
                            </h4>
                            <div className="flex gap-1 ml-2">
                              <Button
                                type="primary"
                                icon={<EditOutlined />}
                                size="small"
                                onClick={() => openEditModal(faq)}
                              />
                              <Button
                                danger
                                icon={<DeleteOutlined />}
                                size="small"
                                onClick={() => {
                                  Modal.confirm({
                                    title: 'ÿ≠ÿ∞ŸÅ ÿßŸÑÿ≥ÿ§ÿßŸÑ',
                                    content: 'ŸáŸÑ ÿ£ŸÜÿ™ ŸÖÿ™ÿ£ŸÉÿØ ŸÖŸÜ ÿ≠ÿ∞ŸÅ Ÿáÿ∞ÿß ÿßŸÑÿ≥ÿ§ÿßŸÑÿü',
                                    onOk: () => deleteFAQ(faq._id),
                                  });
                                }}
                              />
                            </div>
                          </div>
                          <p className="text-gray-600 text-xs line-clamp-2">
                            {faq.answer.ar}
                          </p>
                          <div className="flex justify-between items-center text-xs">
                            <span className={`px-2 py-1 rounded-full text-white ${
                              faq.status === 'active' ? 'bg-green-500' : 'bg-gray-400'
                            }`}>
                              {faq.status === 'active' ? 'ŸÜÿ¥ÿ∑' : 'ÿ∫Ÿäÿ± ŸÜÿ¥ÿ∑'}
                            </span>
                            <span className="text-gray-500">ÿ™ÿ±ÿ™Ÿäÿ®: {faq.order}</span>
                          </div>
                        </div>
                      </Card>
                    ))}
                  </div>
                </div>
              )
            }
          ]}
        />
      ) : (
        // Desktop Layout
        <div className="space-y-6">
          {/* Settings Card */}
          <Card title="ÿ•ÿπÿØÿßÿØÿßÿ™ ÿßŸÑÿµŸÅÿ≠ÿ©" className="bg-blue-50">
            <Form form={settingsForm} layout="vertical" initialValues={pageSettings} key={JSON.stringify(pageSettings)}>
              <Row gutter={16}>
                <Col span={12}>
                  <Form.Item name="pageTitle" label="ÿπŸÜŸàÿßŸÜ ÿßŸÑÿµŸÅÿ≠ÿ©">
                    <Input placeholder="ÿßŸÑÿ£ÿ≥ÿ¶ŸÑÿ© ÿßŸÑÿ¥ÿßÿ¶ÿπÿ©" />
                  </Form.Item>
                </Col>
                <Col span={12}>
                  <Form.Item name="pageDescription" label="ŸàÿµŸÅ ÿßŸÑÿµŸÅÿ≠ÿ©">
                    <Input placeholder="ÿ•ÿ¨ÿßÿ®ÿßÿ™ ÿ¥ÿßŸÖŸÑÿ© ÿπŸÑŸâ ÿ£ŸÉÿ´ÿ± ÿßŸÑÿ£ÿ≥ÿ¶ŸÑÿ©..." />
                  </Form.Item>
                </Col>
              </Row>

            <Form.Item name="introText" label="ÿßŸÑŸÜÿµ ÿßŸÑÿ™ŸÖŸáŸäÿØŸä">
              <TextArea rows={2} placeholder="ŸÜÿ¨ŸÖÿπ ŸáŸÜÿß ÿ£ŸÉÿ´ÿ± ÿßŸÑÿ£ÿ≥ÿ¶ŸÑÿ© ÿ¥ŸäŸàÿπÿßŸã..." />
            </Form.Item>

            <Form.Item name="contactText" label="ŸÜÿµ ÿßŸÑÿ™ŸàÿßÿµŸÑ">
              <TextArea rows={2} placeholder="ŸÑŸÖ ÿ™ÿ¨ÿØ ÿ•ÿ¨ÿßÿ®ÿ©ÿü ÿ™ŸàÿßÿµŸÑ ŸÖÿπŸÜÿß..." />
            </Form.Item>

            {/* SEO Settings - Hidden but preserved */}
            <div style={{ display: 'none' }}>
              <Divider>ÿ•ÿπÿØÿßÿØÿßÿ™ SEO</Divider>

              <Form.Item name="seoTitle" label="ÿπŸÜŸàÿßŸÜ ÿßŸÑÿµŸÅÿ≠ÿ© (SEO)">
                <Input placeholder="ÿßŸÑÿ£ÿ≥ÿ¶ŸÑÿ© ÿßŸÑÿ¥ÿßÿ¶ÿπÿ© | ÿ®ÿµŸÖÿ© ÿ™ÿµŸÖŸäŸÖ..." />
              </Form.Item>

              <Form.Item name="seoDescription" label="ŸàÿµŸÅ ÿßŸÑÿµŸÅÿ≠ÿ© (SEO)">
                <TextArea rows={3} placeholder="ÿ•ÿ¨ÿßÿ®ÿßÿ™ ÿ¥ÿßŸÖŸÑÿ© ÿπŸÑŸâ ÿ£ŸÉÿ´ÿ± ÿßŸÑÿ£ÿ≥ÿ¶ŸÑÿ© ÿ¥ŸäŸàÿπÿßŸã..." />
              </Form.Item>

              <Row gutter={16}>
                <Col span={8}>
                  <Form.Item name="seoKeywords" label="ÿßŸÑŸÉŸÑŸÖÿßÿ™ ÿßŸÑŸÖŸÅÿ™ÿßÿ≠Ÿäÿ©">
                    <Input placeholder="ÿ£ÿ≥ÿ¶ŸÑÿ© ÿ¥ÿßÿ¶ÿπÿ©ÿå ÿßÿ≥ÿ™ŸÅÿ≥ÿßÿ±ÿßÿ™..." />
                  </Form.Item>
                </Col>
                <Col span={8}>
                  <Form.Item name="ogImage" label="ÿµŸàÿ±ÿ© ÿßŸÑŸÖÿ¥ÿßÿ±ŸÉÿ©">
                    <Input placeholder="/faq-og-image.jpg" />
                  </Form.Item>
                </Col>
                <Col span={8}>
                  <Form.Item name="canonicalUrl" label="ÿßŸÑÿ±ÿßÿ®ÿ∑ ÿßŸÑÿ£ÿ≥ÿßÿ≥Ÿä">
                    <Input placeholder="https://basmatdesign.com/faq" />
                  </Form.Item>
                </Col>
              </Row>
            </div>

            <div className="flex justify-end gap-4">
              <Button 
                type="primary" 
                icon={<SaveOutlined />}
                onClick={savePageSettings}
                loading={saving}
              >
                ÿ≠ŸÅÿ∏ ÿßŸÑÿ•ÿπÿØÿßÿØÿßÿ™
              </Button>
            </div>
          </Form>
        </Card>

        {/* FAQs Management Card */}
        <Card 
          title="ÿ•ÿØÿßÿ±ÿ© ÿßŸÑÿ£ÿ≥ÿ¶ŸÑÿ© ŸàÿßŸÑÿ•ÿ¨ÿßÿ®ÿßÿ™" 
          className="bg-green-50"
          extra={
            <Space>
              <Button 
                type="primary" 
                icon={<PlusOutlined />}
                onClick={() => openEditModal()}
              >
                ÿ•ÿ∂ÿßŸÅÿ© ÿ≥ÿ§ÿßŸÑ ÿ¨ÿØŸäÿØ
              </Button>
              <Button 
                icon={<ReloadOutlined />}
                onClick={loadFAQs}
                loading={loading}
              >
                ÿ™ÿ≠ÿØŸäÿ´
              </Button>
              <Button 
                icon={<EyeOutlined />}
                href="/faq"
                target="_blank"
              >
                ŸÖÿπÿßŸäŸÜÿ© ÿßŸÑÿµŸÅÿ≠ÿ©
              </Button>
            </Space>
          }
        >
          <div className="faq-table-wrapper">
            <style jsx>{`
              .faq-table-wrapper .ant-table {
                border-radius: 12px;
                overflow: hidden;
                box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
                border: 1px solid #e5e7eb;
              }
              
              .faq-table-wrapper .ant-table-thead > tr > th {
                background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
                border-bottom: 2px solid #e2e8f0;
                font-weight: 600;
                color: #374151;
                padding: 16px;
                position: relative;
              }
              
              .faq-table-wrapper .ant-table-thead > tr > th::after {
                content: '';
                position: absolute;
                bottom: 0;
                left: 0;
                right: 0;
                height: 2px;
                background: linear-gradient(90deg, #3b82f6, #8b5cf6, #06b6d4);
              }
              
              .faq-table-wrapper .ant-table-tbody > tr > td {
                padding: 20px 16px;
                border-bottom: 1px solid #f1f5f9;
                vertical-align: top;
              }
              
              .faq-table-wrapper .ant-table-tbody > tr:hover > td {
                background: linear-gradient(135deg, #dbeafe 0%, #e0e7ff 100%);
                transform: scale(1.001);
                box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
              }
              
              .faq-table-wrapper .ant-table-tbody > tr {
                transition: all 0.3s ease;
              }
              
              .faq-table-wrapper .ant-table-tbody > tr:nth-child(even) {
                background-color: rgba(248, 250, 252, 0.5);
              }
              
              .faq-table-wrapper .ant-table-tbody > tr:nth-child(odd) {
                background-color: rgba(255, 255, 255, 1);
              }
              
              .faq-table-wrapper .ant-table-pagination {
                margin-top: 20px;
                padding: 16px;
                background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
                border-radius: 12px;
                border: 1px solid #e2e8f0;
              }
              
              .line-clamp-2 {
                display: -webkit-box;
                -webkit-line-clamp: 2;
                -webkit-box-orient: vertical;
                overflow: hidden;
              }
            `}</style>
            
            <Table
              columns={columns}
              dataSource={faqs}
              rowKey="_id"
              loading={loading}
              size="middle"
              pagination={{
                total: faqs.length,
                pageSize: 8,
                showSizeChanger: true,
                showQuickJumper: true,
                showTotal: (total, range) => (
                  <div className="flex items-center gap-2 text-gray-600">
                    <span className="bg-blue-100 text-blue-800 px-2 py-1 rounded-full text-sm font-medium">
                      üìã ÿßŸÑŸÖÿ¨ŸÖŸàÿπ: {total} ÿ≥ÿ§ÿßŸÑ
                    </span>
                    <span className="text-sm">
                      ({range[0]}-{range[1]} ŸÖŸÜ {total})
                    </span>
                  </div>
                ),
                pageSizeOptions: ['5', '8', '10', '20'],
                className: "custom-pagination"
              }}
            />
          </div>
        </Card>
      </div>
      )}

      {/* FAQ Modal */}
      <Modal
        title={editingFaq ? 'ÿ™ÿπÿØŸäŸÑ ÿßŸÑÿ≥ÿ§ÿßŸÑ' : 'ÿ•ÿ∂ÿßŸÅÿ© ÿ≥ÿ§ÿßŸÑ ÿ¨ÿØŸäÿØ'}
        open={isModalVisible}
        onOk={saveFAQ}
        onCancel={() => {
          setIsModalVisible(false);
          setEditingFaq(null);
          faqForm.resetFields();
        }}
        okText="ÿ≠ŸÅÿ∏"
        cancelText="ÿ•ŸÑÿ∫ÿßÿ°"
        width={isMobile ? '95%' : 800}
        style={isMobile ? { top: 20 } : {}}
      >
        <Form form={faqForm} layout="vertical">
          <Row gutter={16}>
            <Col span={24}>
              <Form.Item 
                name={['question', 'ar']} 
                label="ÿßŸÑÿ≥ÿ§ÿßŸÑ (ÿπÿ±ÿ®Ÿä)" 
                rules={[{ required: true, message: 'Ÿäÿ±ÿ¨Ÿâ ÿ•ÿØÿÆÿßŸÑ ÿßŸÑÿ≥ÿ§ÿßŸÑ ÿ®ÿßŸÑŸÑÿ∫ÿ© ÿßŸÑÿπÿ±ÿ®Ÿäÿ©' }]}
              >
                <TextArea rows={3} placeholder="ŸÖÿß ŸáŸä ŸÖÿØÿ© ÿ™ŸÜŸÅŸäÿ∞ ÿßŸÑŸÖÿ¥ÿ±Ÿàÿπÿü" />
              </Form.Item>
            </Col>
          </Row>

          <Row gutter={16}>
            <Col span={24}>
              <Form.Item 
                name={['answer', 'ar']} 
                label="ÿßŸÑÿ•ÿ¨ÿßÿ®ÿ© (ÿπÿ±ÿ®Ÿä)" 
                rules={[{ required: true, message: 'Ÿäÿ±ÿ¨Ÿâ ÿ•ÿØÿÆÿßŸÑ ÿßŸÑÿ•ÿ¨ÿßÿ®ÿ© ÿ®ÿßŸÑŸÑÿ∫ÿ© ÿßŸÑÿπÿ±ÿ®Ÿäÿ©' }]}
              >
                <TextArea rows={5} placeholder="ŸÖÿØÿ© ÿ™ŸÜŸÅŸäÿ∞ ÿßŸÑŸÖÿ¥ÿ±Ÿàÿπ ÿ™ÿ™ÿ±ÿßŸàÿ≠ ÿ®ŸäŸÜ..." />
              </Form.Item>
            </Col>
          </Row>

          <Row gutter={16}>
            <Col span={isMobile ? 24 : 16}>
              <Form.Item 
                name="category" 
                label="ÿßŸÑÿ™ÿµŸÜŸäŸÅ"
                rules={[{ required: true, message: 'Ÿäÿ±ÿ¨Ÿâ ÿßÿÆÿ™Ÿäÿßÿ± ÿßŸÑÿ™ÿµŸÜŸäŸÅ' }]}
              >
                <Radio.Group className="w-full">
                  <div className={`grid gap-2 ${isMobile ? 'grid-cols-1' : 'grid-cols-2'}`}>
                    {categories.map(cat => (
                      <Radio key={cat.value} value={cat.value} className="p-2 border border-gray-200 rounded-lg hover:border-blue-300 hover:bg-blue-50">
                        <span className="font-medium">{cat.label}</span>
                      </Radio>
                    ))}
                  </div>
                </Radio.Group>
              </Form.Item>
            </Col>
            <Col span={isMobile ? 24 : 8}>
              <Form.Item name="order" label="ÿ™ÿ±ÿ™Ÿäÿ® ÿßŸÑÿπÿ±ÿ∂" initialValue={faqs.length + 1}>
                <Input type="number" min={1} />
              </Form.Item>
              <Form.Item name="status" initialValue="active" hidden>
                <Input type="hidden" />
              </Form.Item>
            </Col>
          </Row>
        </Form>
      </Modal>
    </div>
  );
}
